############################################################
# Makefile for HMMER src directory
# CVS $Id$
###########
# @LICENSE@
###########

## your compiler and compiler flags
#
CC     = @CC@
CFLAGS = @CFLAGS@

## other defined flags. 
#  @DEFS@ contains stuff that autoconf 
#  decides on. @MDEFS@ contains stuff that we added to
#  the configure script tests. @LIBS@ contains system
#  libraries that the configure script decides we need.
#
MDEFS = @MDEFS@ @DEFS@
LIBS  = @LIBS@ 

## archiving command, and ranlib command if you need one.
#  In general, you shouldn't need to change these, and they're
#  only used for building the testsuite anyway... e.g. we
#  make a "libhmmer.a" library for building the testsuite.
#
AR     = ar rcv 
RANLIB = @RANLIB@

# Configuration for optional PVM functionality
#
PVMFLAG   = @PVMFLAG@
PVMLIBDIR = @PVMLIBDIR@
PVMINCDIR = @PVMINCDIR@
PVMLIBS   = @PVMLIBS@
PVMPROGS  = @PVMPROGS@

# Where the build arena is (module .h and .o files)
#
ARENA = @top_srcdir@/@ARENA@

#######
## Neither you nor configure should need to modify below this line
#######
SHELL    = /bin/sh
MYLIBS   = -lsquid
MYLIBDIR = -L${ARENA}
MYINCDIR = -I${ARENA}

PROGS = hmmalign\
	hmmbuild\
	hmmcalibrate\
	hmmconvert\
	hmmemit\
	hmmfetch\
	hmmindex\
	hmmpfam\
	hmmsearch

OBJS =  alphabet.o\
	core_algorithms.o\
	debug.o\
	display.o\
	emit.o\
	emulation.o\
	histogram.o\
	hmmio.o\
	mathsupport.o\
        masks.o\
	misc.o\
	modelmakers.o\
	plan7.o\
	plan9.o\
	postprob.o\
	prior.o\
	stopwatch.o\
	threads.o\
	tophits.o\
	trace.o 

HDRS =  config.h\
	funcs.h\
	globals.h\
	postprob.h\
	stopwatch.h\
	structs.h

PVMOBJS = pvm.o

.c.o:
	$(CC) $(CFLAGS) $(MDEFS) $(PTHREADFLAG) $(PVMFLAG) $(MYINCDIR) $(PVMINCDIR) -c $<

#######
## Targets defining how to make HMMER executables.
#######

all: 	$(PROGS) $(PVMPROGS) 

hmmalign: $(OBJS) hmmalign.o
	$(CC) $(CFLAGS) $(MDEFS)$(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmbuild: $(OBJS) hmmbuild.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmcalibrate: $(OBJS) $(PVMOBJS) hmmcalibrate.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmconvert: $(OBJS) hmmconvert.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmemit: $(OBJS) hmmemit.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmfetch: $(OBJS) hmmfetch.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmindex: $(OBJS) hmmindex.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMLIBS) $(MYLIBS) $(LIBS) 
hmmpfam: $(OBJS) $(PVMOBJS) hmmpfam.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmsearch: $(OBJS) $(PVMOBJS) hmmsearch.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmcalibrate-pvm: $(OBJS) $(PVMOBJS) hmmcalibrate-pvm.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmpfam-pvm: $(OBJS) $(PVMOBJS) hmmpfam-pvm.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)
hmmsearch-pvm: $(OBJS) $(PVMOBJS) hmmsearch-pvm.o
	$(CC) $(CFLAGS) $(MDEFS) $(MYLIBDIR) $(PVMLIBDIR) -o $@ $@.o $(OBJS) $(PVMOBJS) $(PVMLIBS) $(MYLIBS) $(LIBS)

####################################################################
## Targets used in making HMMER module for testsuite compilation
##
module-install: libhmmer.a
	mv libhmmer.a ${ARENA}/
	cp $(HDRS)    ${ARENA}/

module: libhmmer.a

libhmmer.a: $(OBJS) $(PVMOBJS)
	$(AR) libhmmer.a $(OBJS) $(PVMOBJS)
	$(RANLIB) libhmmer.a
	chmod 644 libhmmer.a

#######
## Miscellaneous
#######

distclean:
	make clean
	-rm -f Makefile version.h

clean:
	-rm -f *.o *~ Makefile.bak core $(PROGS) $(PVMPROGS) TAGS gmon.out libhmmer.a

TAGS:
	etags -t *.c *.h Makefile.in

