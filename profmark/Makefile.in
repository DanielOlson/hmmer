top_srcdir = @top_srcdir@
srcdir     = @srcdir@
VPATH      = @srcdir@ 

CC       = @CC@
CFLAGS   = @CFLAGS@
CPPFLAGS = @CPPFLAGS@
LDFLAGS  = @LDFLAGS@
SIMDFLAGS= @SIMD_CFLAGS@
DEFS     = @DEFS@
LIBS     = @LIBS@ @LIBGSL@ -lm
MPILIBS  = @MPILIBS@
IMPLDIR  = impl_@IMPL_CHOICE@

ESLINC   = -I../easel -I${top_srcdir}/easel
SRCINC   = -I../src   -I${top_srcdir}/src

PROGS    = create-profmark\
	   rocplot

# beautification magic stolen from git 
QUIET_SUBDIR0 = +${MAKE} -C #space separator after -c
QUIET_SUBDIR1 = 
ifndef V
	QUIET_CC      = @echo '    ' CC $@;
	QUIET_GEN     = @echo '    ' GEN $@;
	QUIET_AR      = @echo '    ' AR $@;
	QUIET_SUBDIR0 = +@subdir=
	QUIET_SUBDIR1 = ; echo '    ' SUBDIR $$subdir; \
		        ${MAKE} -C $$subdir
endif

.PHONY: all distclean clean

all:    ${PROGS}

../easel/libeasel.a:
	${QUIET_SUBDIR0}../easel ${QUIET_SUBDIR1} libeasel.a

../src/libhmmer.a:
	${QUIET_SUBDIR0}../src   ${QUIET_SUBDIR1} libhmmer.a

${PROGS}: @EXEC_DEPENDENCY@  ../easel/libeasel.a ../src/libhmmer.a
	${QUIET_GEN}${CC} ${CFLAGS} ${DEFS} ${LDFLAGS} -L../easel -L../src -o $@ $@.o -lhmmer -leasel ${LIBS}

.c.o: 
	${QUIET_CC}${CC} ${ESLINC} ${SRCINC} ${CFLAGS} ${SIMDFLAGS} ${DEFS} -o $@ -c $<		

distclean: clean
	-rm -f Makefile

clean:
	-rm -f *.o *~  ${PROGS} TAGS
	-rm -f *.gcno

################################################################
# @LICENSE@
################################################################

